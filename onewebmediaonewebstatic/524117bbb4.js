/*---------------------------------------------------------------------------------------------

@author       Constantin Saguin - @brutaldesign
@link         http://csag.co
@github       http://github.com/One-com/shinybox
@version      5.1.0
@license      MIT License

----------------------------------------------------------------------------------------------*/
!function(factory){var $;window.Shinybox=($=oneJQuery,void function(window,document,$,undefined){var $window=$(window),$html=$("html"),$body=$(document.body),isMobile=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(Android)|(PlayBook)|(BB10)|(BlackBerry)|(Opera Mini)|(IEMobile)|(webOS)|(MeeGo)/i),isTouch=null!==isMobile||void 0!==document.createTouch||"ontouchstart"in window||"onmsgesturechange"in window||navigator.msMaxTouchPoints,supportCssTransition=(!!document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,["transition","WebkitTransition","MozTransition","OTransition","msTransition","KhtmlTransition"].some((function(prefix){return void 0!==document.createElement("div").style[prefix]}))),windowDimensions=getWindowDimensions(),resizeOps=[function(){windowDimensions=getWindowDimensions()}];$window.resize((function(e){resizeOps.forEach((function(operation){operation(e)}))})),"onorientationchange"in window&&window.addEventListener("orientationchange",(function(){windowDimensions=getWindowDimensions()}),!1);var defaultOptions={id:"shinybox-overlay",useCSS:!0,noTitleCaptionBox:!1,hideCloseButtonOnMobile:!1,loopAtEnd:!1,showNavigationsOnMobile:!1,initialIndexOnArray:0,sort:null,videoMaxWidth:1140,autoplayVideos:!1,vimeoColor:"CCCCCC",queryStringData:{},beforeOpen:noop,afterClose:noop,afterMedia:noop,afterSlide:noop,verticalSwipeDisable:!1};function Shinybox(element,options){var eventCatcher,$selectedElements,self=this instanceof Shinybox?this:{},settings=$.extend({},defaultOptions,options),selector=element.selector;if(settings.afterDestroy=function(){eventCatcher.trigger("shinybox-destroy"),self.ui=null},$.isArray(element))eventCatcher=$window,self.destroy=function(){self.ui&&self.ui.destroy()},self.refresh=function(){self.destroy(),self.ui=new UI(element,settings),eventCatcher.trigger("shinybox-start"),self.ui.openWithSlide(settings.initialIndexOnArray)};else{function openShinyboxOnClick(e){var getAncestorOrSelfWithDataSpecificKind=function(el){for(;el;){if(el.getAttribute&&el.getAttribute("data-specific-kind"))return el;el=el.parentNode}return el};if("slide current"===e.target.parentNode.className)return!1;if(getAncestorOrSelfWithDataSpecificKind(event.target)!=getAncestorOrSelfWithDataSpecificKind(event.currentTarget))return!0;e.preventDefault(),e.stopPropagation(),self.ui&&self.ui.destroy();var $slideElements,$this=$(this),relType="data-rel",relVal=$this.attr(relType);relVal||(relType="rel",relVal=$this.attr(relType)),$slideElements=relVal&&"nofollow"!==relVal?$selectedElements.filter("["+relType+'="'+relVal+'"]'):$(selector);var filteredSlides=Array.prototype.filter.call($slideElements,(function(slideElement){return!$(slideElement).data("ignore")})),index=void 0!==$this.data("dom-index")?$this.data("dom-index")-$(filteredSlides[0]).data("dom-index"):$(filteredSlides).index($this),slides=Array.prototype.map.call(filteredSlides,(function(slideElement){var $slideElement=$(slideElement);return{href:$slideElement.attr("href")||null,title:$slideElement.attr("title")||null,caption:$slideElement.attr("caption")||null,srcset:$slideElement.attr("data-srcset")||null,forceMediaType:$slideElement.attr("data-force-media-type")||null,forceMediaUrl:$slideElement.attr("data-force-media-url")||null,mediaAlbumItems:$slideElement.attr("data-media-album-items")||[]}}));eventCatcher=$(e.target),self.ui=new UI(slides,settings),eventCatcher.trigger("shinybox-start"),self.ui.openWithSlide(index)}self.destroy=function(){$selectedElements&&$selectedElements.off("click",openShinyboxOnClick),self.ui&&self.ui.destroy()},self.refresh=function(){self.destroy(),$selectedElements=element,settings.sort&&$selectedElements.sort(settings.sort),$selectedElements.on("click",openShinyboxOnClick)}}return self.refresh(),self}function UI(slides,settings){this.slides=slides,this.settings=settings,this.currentX=0,this.build()}return UI.prototype.build=function(){this.overlay=$('<div id="'+this.settings.id+'"  class="shinybox-overlay" />'),this.closeButton=$('<a class="shinybox-close" />'),this.captionBox=$('<div class="shinybox-caption captionTitle"></div>'),this.caption=$('<p class="caption"></p>'),this.title=$('<p class="title"></p>'),this.captionBox.append(this.title,this.caption),this.navigationContainer=$('<div class="navigationContainer"></div>'),this.slider=$('<div class="shinybox-slider"></div>'),this.prevButton=$('<a class="shinybox-prev" />'),this.nextButton=$('<a class="shinybox-next" />'),this.navigationContainer.append(this.prevButton,this.nextButton),this.overlay.append(this.slider,this.closeButton,this.captionBox,this.navigationContainer),isMobile&&this.overlay.addClass("mobile-view"),this.settings.noTitleCaptionBox&&this.overlay.addClass("noTitleCaptionBox"),this.settings.showNavigationsOnMobile||this.navigationContainer.addClass("hideMe"),$body.append(this.overlay),this.slides.forEach((function(){this.slider.append('<div class="slide"></div>')}),this),this.slideElements=this.slider.find(".slide"),this.updateDimensions(),this.setupButtonNavigation(),this.setupGestureNavigation(),this.setupKeyboardNavigation(),this.setupWindowResizeEvent()},UI.prototype.doCssTrans=function(){return this.settings.useCSS&&supportCssTransition},UI.prototype.updateDimensions=function(){$.extend({},windowDimensions)},UI.prototype.setupButtonNavigation=function(){var self=this;this.slides.length<2?this.navigationContainer.hide():(this.prevButton.on("click touchend",(function(e){e.preventDefault(),e.stopPropagation(),self.getPrev()})),this.nextButton.on("click touchend",(function(e){e.preventDefault(),e.stopPropagation(),self.getNext()}))),this.closeButton.on("click touchend",(function(e){e.preventDefault(),e.stopPropagation(),self.destroy()})),this.slideElements.click((function(e){e.target===this&&e.target.children.length>=1&&self.destroy()}))},UI.prototype.setupGestureNavigation=function(){if(isTouch){var index,hDistance,vDistance,hDistanceLast,vDistanceLast,hDistancePercent,self=this,vSwipe=!1,hSwipe=!1,startCoords={},endCoords={},touchMoveEventHandler=function(e){if(e.preventDefault(),e.stopPropagation(),endCoords=e.originalEvent.targetTouches[0],!hSwipe&&!self.settings.verticalSwipeDisable&&(vDistanceLast=vDistance,vDistance=endCoords.pageY-startCoords.pageY,Math.abs(vDistance)>=50||vSwipe)){var opacity=.75-Math.abs(vDistance)/self.slider.height();self.slider.css({top:vDistance+"px",opacity:opacity}),vSwipe=!0}hDistanceLast=hDistance,hDistance=endCoords.pageX-startCoords.pageX,hDistancePercent=100*hDistance/windowDimensions.width,!hSwipe&&!vSwipe&&Math.abs(hDistance)>=10&&(self.slider.addClass("notransition"),hSwipe=!0),hSwipe&&(0<hDistance?self.moveSlider(self.currentX+(0===index?4:hDistancePercent)):0>hDistance&&self.moveSlider(self.currentX+(self.slides.length===index+1?-4:hDistancePercent)))},touchPoints=null,touchPointsLength=0;this.overlay.on("touchstart",(function(e){if(e.originalEvent.touches&&e.originalEvent.touches.length>1)return $(this).off("touchmove",touchMoveEventHandler),!0;index=self.getCurrentIndex(),endCoords=e.originalEvent.targetTouches[0],touchPoints=e.originalEvent.targetTouches,touchPointsLength=touchPoints.length,startCoords.pageX=e.originalEvent.targetTouches[0].pageX,startCoords.pageY=e.originalEvent.targetTouches[0].pageY,self.moveSlider(self.currentX),$(this).on("touchmove",touchMoveEventHandler)})),this.overlay.on("touchend",(function(e){if(e.originalEvent.touches&&e.originalEvent.touches.length>1)return $(this).off("touchmove",touchMoveEventHandler),!0;e.stopPropagation(),self.slider.removeClass("notransition"),vDistance=endCoords.pageY-startCoords.pageY,hDistance=endCoords.pageX-startCoords.pageX;var hasOneTouchPoint=1===touchPointsLength;if(vSwipe&&!self.settings.verticalSwipeDisable)if(vSwipe=!1,Math.abs(vDistance)>=100&&Math.abs(vDistance)>Math.abs(vDistanceLast)&&hasOneTouchPoint){var vOffset=vDistance>0?self.slider.height():-self.slider.height();self.slider.animate({top:vOffset+"px",opacity:0},300,(function(){self.destroy()}))}else self.slider.animate({top:0,opacity:1},300);else hSwipe&&(hSwipe=!1,hDistance>=10&&hDistance>=hDistanceLast&&hasOneTouchPoint?self.getPrev():hDistance<=-10&&hDistance<=hDistanceLast&&hasOneTouchPoint&&self.getNext());self.moveSlider(self.currentX),$(this).off("touchmove",touchMoveEventHandler)}))}},UI.prototype.setupKeyboardNavigation=function(){var self=this;this._keyDownEvent=function(e){if(!self.isOpen)return!0;37===e.keyCode||8===e.keyCode?(e.preventDefault(),e.stopPropagation(),self.getPrev()):39===e.keyCode?(e.preventDefault(),e.stopPropagation(),self.getNext()):27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),self.destroy())},$window.on("keydown",this._keyDownEvent)},UI.prototype.setupWindowResizeEvent=function(){var self=this;this.resizeIndex=resizeOps.push((function(){self.updateDimensions()}))-1},UI.prototype.validateIndex=function(index){return index<0||index>this.slides.length-1?0:index},UI.prototype.getCurrentIndex=function(){return this.slideElements.index(this.slideElements.filter(".current"))},UI.prototype.moveSlider=function(x){this.doCssTrans()?this.slider.css({left:x+"%"}):this.slider.animate({left:x+"%"})},UI.prototype.setSlide=function(index,isFirst){$("video").each((function(){$(this).is("visible")||($(this)[0].pause(),$(this)[0].currentTime=0)})),isFirst=isFirst||!1,index=this.validateIndex(index),this.currentX=100*-index,this.moveSlider(this.currentX),this.slideElements.removeClass("current"),this.slideElements.eq(index).addClass("current"),this.setTitle(index),isFirst&&this.slider.fadeIn(),this.settings.loopAtEnd||(this.prevButton.removeClass("disabled"),this.nextButton.removeClass("disabled"),0===index?this.prevButton.addClass("disabled"):index===this.slides.length-1&&this.nextButton.addClass("disabled")),this.settings.afterSlide(this.slideElements.filter(".current").children(),index)},UI.prototype.setTitle=function(index){index=this.validateIndex(index);var title=this.slides[index].title,caption=this.slides[index].caption;title||caption?this.captionBox.removeClass("noTitleCaption"):this.captionBox.addClass("noTitleCaption"),this.caption.text(caption||""),this.title.text(title||"")},UI.prototype.openWithSlide=function(index){var nextIndex=(index=this.validateIndex(index))<this.slides.length-1?index+1:0,prevIndex=index>0?index-1:this.slides.length-1;this.open(),this.setSlide(index),this.preloadMedia(index),(this.settings.loopAtEnd||0!==nextIndex)&&this.preloadMedia(nextIndex),(this.settings.loopAtEnd||prevIndex!==this.slides.length-1)&&this.preloadMedia(prevIndex)},UI.prototype.getNext=function(){var self=this,currentIndex=this.getCurrentIndex(),nextIndex=currentIndex+1<this.slides.length?currentIndex+1:0,preloadIndex=nextIndex+1<this.slides.length?nextIndex+1:0;this.settings.loopAtEnd||currentIndex+1<this.slides.length?(this.resetIframeInSlide(currentIndex),this.setSlide(nextIndex),this.preloadMedia(preloadIndex)):(this.overlay.addClass("rightSpring"),setTimeout((function(){self.overlay.removeClass("rightSpring")}),500))},UI.prototype.getPrev=function(){var self=this,currentIndex=this.getCurrentIndex(),prevIndex=currentIndex>0?currentIndex-1:this.slides.length-1,preloadIndex=prevIndex>0?prevIndex-1:this.slides.length-1;this.settings.loopAtEnd||currentIndex>0?(this.resetIframeInSlide(currentIndex),this.setSlide(prevIndex),this.preloadMedia(preloadIndex)):(this.overlay.addClass("leftSpring"),setTimeout((function(){self.overlay.removeClass("leftSpring")}),500))},UI.prototype.resetIframeInSlide=function(index){index=this.validateIndex(index);var iframeInSlide=this.slideElements.eq(index).contents().find("iframe");iframeInSlide.length&&iframeInSlide.attr("src",iframeInSlide.attr("src"))},UI.prototype.preloadMedia=function(index){index=this.validateIndex(index);var self=this,src=this.slides[index].href,srcset=this.slides[index].srcset;this.isVideo(src)?this.openMedia(index,src,srcset):setTimeout((function(){self.openMedia(index,src,srcset)}),300)},UI.prototype.openMedia=function(index,src,srcset){index=this.validateIndex(index);var self=this,title=this.slides[index].title||"",alt=this.slides[index].alt||title,forceMediaType=this.slides[index].forceMediaType,forceMediaUrl=this.slides[index].forceMediaUrl,mediaAlbumItems=this.slides[index].mediaAlbumItems;if(src||(src=this.slides[index].href),srcset||(srcset=this.slides[index].srcset),!src&&"NO_FACEBOOK_MEDIA"!==forceMediaType)return!1;if(mediaAlbumItems)try{mediaAlbumItems=JSON.parse(mediaAlbumItems)}catch(e){}var $slide=this.slideElements.eq(index);this.isVideo(src)?($slide.html(this.getVideo(src)),this.settings.afterMedia($slide.children(),index)):"SELF_HOSTED_VIDEO"===forceMediaType?($slide.html('<div class="loadingWrapper"><div class="loading"></div></div>'),this.loadVideoMedia(forceMediaUrl,(function(media){media.attr("title",title),media.attr("alt",alt),$slide.html(media),self.settings.afterMedia($slide.children(),index)}))):"NO_FACEBOOK_MEDIA"===forceMediaType?($slide.html('<div class="loadingWrapper"><div class="loading"></div></div>'),this.loadNoFacebookMediaAsset((function(media){media.attr("title",title),media.attr("alt",alt),$slide.html(media),self.settings.afterMedia($slide.children(),index)}))):"ALBUM"===forceMediaType?($slide.html('<div class="loadingWrapper"><div class="loading"></div></div>'),this.loadAlbums(mediaAlbumItems,(function(media){media.attr("title",title),media.attr("alt",alt),$slide.html(media),self.settings.afterMedia($slide.children(),index)}))):this.isPDF(src)?($slide.html(this.getPDF(src)),this.settings.afterMedia($slide.children(),index)):($slide.html('<div class="loadingWrapper"><div class="loading"></div></div>'),this.loadMedia(src,srcset,(function(media){media.attr("title",title),media.attr("alt",alt),$slide.html(media),self.settings.afterMedia($slide.children(),index)})))},UI.prototype.loadMedia=function(src,srcset,callback){if(callback=callback||noop,0===src.trim().indexOf("#"))callback($('<div class="shinybox-inline-container" />').append($(src).clone()));else{var img=$("<img>").on("load",(function(){callback(img)}));img.attr("src",src),img.attr("srcset",srcset)}},UI.prototype.loadNoFacebookMediaAsset=function(callback){(callback=callback||noop)($('<div class ="shinybox-no-facebook-media" />'))},UI.prototype.loadVideoMedia=function(src,callback){callback=callback||noop;var videoTag=$("<video />",{type:"video/mp4",controls:!0,loop:!0,playsinline:!0}).on("loadstart",(function(){callback(videoTag)}));videoTag.attr("src",src)},UI.prototype.loadAlbums=function(albumItems,callback){callback=callback||noop;var album=$("<div />",{class:"album-container"}),listContainer=$("<ul>");album.append(listContainer);var albumNavContainer=$("<div />",{style:"height: 50px;",class:"album-nav-container"}),albumLeftNav=$("<span/>",{class:"album-left"}),albumRightNav=$("<span/>",{class:"album-right"});albumLeftNav.css("display","none"),albumRightNav.css("display","none"),albumNavContainer.append(albumLeftNav),albumNavContainer.append(albumRightNav),album.append(albumNavContainer),$(albumItems).each((function(index,item){var itemEl;"IMAGE"===item.media_type?itemEl=function(item){var imgTag=$("<img>").on("load",(function(){$(imgTag).height($(imgTag).parents(".album-container").height()-50),albumLeftNav.css("display","inline-block"),albumRightNav.css("display","inline-block")}));return imgTag.attr("src",item.media_url),$("<li>").append(imgTag)}(item):"VIDEO"===item.media_type&&(itemEl=function(item){var videoTag=$("<video />",{type:"video/mp4",controls:!0,loop:!0}).on("loadeddata",(function(){$(videoTag).height($(videoTag).parents(".album-container").height()-50),albumLeftNav.css("display","inline-block"),albumRightNav.css("display","inline-block")}));return videoTag.attr("src",item.media_url),$("<li>").append(videoTag)}(item)),0===index?(itemEl.addClass("shown"),itemEl.show(),albumLeftNav.addClass("disabled")):(albumRightNav.removeClass("disabled"),itemEl.hide()),listContainer.append(itemEl)})),albumLeftNav.on("click",(function(event){var currentItem=$(event.target).parents(".album-container").find(".shown"),leftItem=currentItem.prev();leftItem.length>0&&(currentItem.hide().removeClass("shown"),leftItem.show().addClass("shown"),albumRightNav.removeClass("disabled"),leftItem.prev().length>0?albumLeftNav.removeClass("disabled"):albumLeftNav.addClass("disabled"))})),albumRightNav.on("click",(function(event){var currentItem=$(event.target).parents(".album-container").find(".shown"),rightItem=currentItem.next();rightItem.length>0&&(currentItem.hide().removeClass("shown"),rightItem.show().addClass("shown"),albumLeftNav.removeClass("disabled"),rightItem.next().length>0?albumRightNav.removeClass("disabled"):albumRightNav.addClass("disabled"))})),callback(album)},UI.prototype.open=function(){this.isOpen=!0,this.settings.beforeOpen(),$html.addClass("shinybox-html"),isMobile&&this.settings.hideCloseButtonOnMobile&&$html.addClass("shinybox-no-close-button"),$window.trigger("resize")},UI.prototype.close=function(){$html.removeClass("shinybox-html shinybox-no-close-button"),$window.trigger("resize"),this.settings.afterClose(),this.isOpen=!1},UI.prototype.destroy=function(){this.close(),$window.off("keydown",this._keyDownEvent),resizeOps.splice(this.resizeIndex,1),this.overlay.remove(),this.settings.afterDestroy()},UI.prototype.isPDF=function(src){return!!src&&src.match(/\.pdf(?:\?|$)/)},UI.prototype.getPDF=function(url){return'<div class="shinybox-pdf-container"><div class="shinybox-pdf"><iframe src="'+url+'"></div></div>'},UI.prototype.isVideo=function(src){if(src){if(src.match(/(youtube\.com|youtube-nocookie\.com)\/watch\?v=([a-zA-Z0-9\-_]+)/)||src.match(/vimeo\.com\/([0-9]*)/)||src.match(/youtu\.be\/([a-zA-Z0-9\-_]+)/))return!0;if(src.toLowerCase().indexOf("shinyboxvideo=1")>=0)return!0}},UI.prototype.parseURI=function(uri,customData){var a=document.createElement("a"),qs={};return a.href=decodeURIComponent(uri),a.search&&(qs=JSON.parse('{"'+a.search.toLowerCase().replace("?","").replace(/&/g,'","').replace(/=/g,'":"')+'"}')),$.isPlainObject(customData)&&(qs=$.extend(qs,customData,this.settings.queryStringData)),$.map(qs,(function(val,key){if(val&&val>"")return encodeURIComponent(key)+"="+encodeURIComponent(val)})).join("&")},UI.prototype.getVideo=function(url){var iframe="",youtubeUrl=url.match(/((?:www\.)?youtube\.com|(?:www\.)?youtube-nocookie\.com)\/watch\?v=([a-zA-Z0-9\-_]+)/),youtubeShortUrl=url.match(/(?:www\.)?youtu\.be\/([a-zA-Z0-9\-_]+)/),vimeoUrl=url.match(/(?:www\.)?vimeo\.com\/([0-9]*)/),qs="";return youtubeUrl||youtubeShortUrl?(youtubeShortUrl&&(youtubeUrl=youtubeShortUrl),qs=this.parseURI(url,{autoplay:this.settings.autoplayVideos?"1":"0",v:""}),iframe='<iframe width="560" height="315" src="//'+youtubeUrl[1]+"/embed/"+youtubeUrl[2]+"?"+qs+'" frameborder="0" allowfullscreen></iframe>'):vimeoUrl?(qs=this.parseURI(url,{autoplay:this.settings.autoplayVideos?"1":"0",byline:"0",portrait:"0",color:this.settings.vimeoColor}),iframe='<iframe width="560" height="315"  src="//player.vimeo.com/video/'+vimeoUrl[1]+"?"+qs+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'):iframe='<iframe width="560" height="315" src="'+url+'" frameborder="0" allowfullscreen></iframe>','<div class="shinybox-video-container" style="max-width:'+this.settings.videomaxWidth+'px"><div class="shinybox-video">'+iframe+"</div></div>"},$.shinybox=Shinybox,$.fn.shinybox=function(options){var instance=this.data("_shinybox");if(instance&&"destroy"===options)return instance.destroy(),this.removeData("_shinybox");if(!instance){var shinybox=new Shinybox(this,options);this.data("_shinybox",shinybox)}return this.data("_shinybox")},Shinybox;function noop(){}function getWindowDimensions(){return{width:window.innerWidth?window.innerWidth:$window.width(),height:window.innerHeight?window.innerHeight:$window.height()}}}(window,document,$))}();